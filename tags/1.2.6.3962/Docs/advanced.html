<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Image Uploader - Дополнительная информация по использованию</title>
<link href="default.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="header">
<h1>Image Uploader</h1> <div id="version">версия 1.2.6</div>
</div>
 <div id="menu">
    <ul>
        <li><a href="index.html">Описание</a></li>        
        <li><a href="usage.html">Использование</a></li>
	 <li><a href="advanced.html">Дополнительная информация</a></li>			
		<!--<li><a href="index.html#license">Лицензия</a></li>
        <li><a href="index.html#versions">История версий</a></li>-->
    </ul>
</div>
<div id="content">
    <div id="left">
<h1>Дополнительная информация</h1>
<h2>Параметры командной строки</h2> 
<p>Формат запуска программы из командной строки выглядит следующим образом:<br/>
<i>"Image Uploader.exe" [параметры] файл1 файл2 ... папка1 папка2 .. </i></p>
<p>Поддерживаются следующие параметры:</p>
<ul>				 
				<li><b>/quick</b> и <b>/noquick</b> — включение и выключение режима быстрого начала загрузки (пропуск страниц мастера)</li>
				<li><b>/mediainfo</b> — показ технической информации для первого видео файла в командной строке</li>
			 	 <li><b>/quickshot</b> — снимок прямоугольной области</li>
				<li><b>/func=fullscreenshot</b> — снимок всего экрана.</li>
			  	<li><b>/func=windowscreenshot</b> — скриншот активного окна.</li>
			  	<li><b>/func=windowhandlescreenshot</b> — снимок выбранного оконного элемента</li>
  			  	<li><b>/func=freeformscreenshot</b> — снимок произвольной формы</li>
				<li><b>/func=screenshotdlg</b> — окно выбора режима скриншота</li>
				<li><b>/func=downloadimages</b> — окно скачивания изображений из Интернета</li>
<li><b>/func=paste</b> — вставка изображения или ссылки из буфера обмена</li>
</ul>
 
<h2>Добавление и редактирование серверов</h2> 
<p>На текущий момент в программе отсутствуют встроенные возможности по модифицированию списка серверов. 

Вся информация о серверах, доступных в программе, содержится в файлe <i>servers.xml</i>, 
находящемся в подкаталоге <i>"Data"</i> каталога, в который установлена программа, либо в 
системной папке <i><span style="white-space: nowrap">"%appdata%\Image Uploader"</span></i>, относящейся к текущему пользователю. 
Программа использует этот файл в режиме "только для чтения".</p>
<p>Файл составлен в соответствии со стандартом <a href="http://ru.wikipedia.org/wiki/XML">XML</a> и 
должен быть сохранен в кодировке utf-16 или utf-8.</p>
<p>XML файл должен иметь следующую структуру:</p>

<div class="xml"><ol><li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;?xml</span> <span class="re0">version</span>=<span class="st0">&quot;1.0&quot;</span> <span class="re0">encoding</span>=<span class="st0">&quot;utf-16&quot;</span> <span class="re0">standalone</span>=<span class="st0">&quot;yes&quot;</span><span class="re2">?&gt;</span></span></div></li>
<li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;Servers<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="sc3"><span class="re1">&lt;Server<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; ...</div></li>
<li class="li2"><div class="de2">&nbsp; <span class="sc3"><span class="re1">&lt;/Server<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="sc3"><span class="re1">&lt;Server<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; ...</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="sc3"><span class="re1">&lt;/Server<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; ...</div></li>
<li class="li2"><div class="de2"><span class="sc3"><span class="re1">&lt;/Servers<span class="re2">&gt;</span></span></span></div></li>
</ol></div>
<p>Последовательность, в которой указаны сервера в этом файле, не имеет значения. Программа сортирует их в алфавитном порядке.</p>
<p>Каждый вложенный узел "Server" имеет следующий вид:</p> 

<div class="xml"><ol><li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;Server</span> <span class="re0">Name</span>=<span class="st0">&quot;название_сервера&quot;</span><span class="re2"> [атрибуты] &gt;</span></span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="sc3"><span class="re1">&lt;Actions<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="sc3"><span class="re1">&lt;Action</span><span class="re2"> [атрибуты] /&gt;</span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="sc3"><span class="re1">&lt;Action</span><span class="re2"> [атрибуты] /&gt;</span></span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; ...</div></li>
<li class="li1"><div class="de1">&nbsp; <span class="sc3"><span class="re1">&lt;/Actions<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; <span class="sc3"><span class="re1">&lt;Result</span> <span class="re0">ImageUrlTemplate</span>=<span class="st0">&quot;...&quot;</span> <span class="re0">ThumbUrlTemplate</span>=<span class="st0">&quot;...&quot;</span> <span class="re0">DownloadUrlTemplate</span>=<span class="st0">&quot;...&quot;</span><span class="re2">/&gt;</span></span></div></li>
<li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;/Server<span class="re2">&gt;</span></span></span></div></li>
</ol></div>
			
<p>Узел <b>Server</b> может иметь следующие <b><i>необязательные атрибуты</i></b>:</p> 

<ul>
	<li><b>Authorize</b> — указывает, поддерживает ли сервер учетные записи. <br/>Значения:  <i>0</i> (по умолчанию) — без авторизации,
		<i>1</i> — сервер поддерживает авторизацию, <i>2</i> — авторизация обязательна.</li>
	<li><b>Debug</b>  — параметр, предназначенный для тестирования и отладки загрузки на данный сервер. 
		При значении <i>1</i> любая загрузка на данный сервер в программе будет сопровождаться отображением информации 
		об отправляемых запросах и принимаемых данных.</li>
	<li><b>FileHost</b> — указывает на то, что сервер является хостингов для любых типов файлов (не только изображений). 
		<br/>Значения:  <i>0</i> (по умолчанию) — хостинг картинок, <i>1</i> — файловый хостинг.</li>
	<li><b>MaxFileSize</b> — максимальный размер загружаемого файла, поддерживаемого сервером. Значение 
		указывается в байтах. Значение по умолчанию — 0, что означает, что файл может быть какого угодно размера.</li>
	<li><b>Plugin</b> — содержит название файла скрипта (без расширения), отвечающего за загрузку на этот сервер. 
		Скрипт должен быть расположен в каталоге Data\Scripts, и иметь расширение ".nut" . Если данный атрибут 
		не пустой, весь узел &lt;Actions&gt; игнорируется, и всё взаимодействие с серверами перекладывается на 
		скрипт. Однако, узел Actions всё равно может быть задан, для обратной совместимости с версиями программы 
		&lt; 1.2.5.<br/>  <a href="#scripts">Подробнее о скриптах...</a></li>
	<li><b>SupportsFolders</b> — поддержка альбомов скриптом загрузки. Используется вместе с атрибутом <i>Plugin</i>.</li>
</ul>

<p>Узел <b>Action</b> (без атрибутов) содержит вложенные узлы Actions, каждый из которых обозначает один HTTP или FTP запрос к серверу. Запросы выполняются в том порядке, в котором они указаны в файле, т.е. сверху вниз.</p> 
<div class="xml"><ol><li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;Action</span> <span class="re0">Type</span>=<span class="st0">&quot;get&quot;</span> <span class="re0">Url</span>=<span class="st0">&quot;http://example.com/&quot;</span> <span class="re0">RegExp</span>=<span class="st0">'id(\d+)'</span> <span class="re0">AssignVars</span>=<span class="st0">&quot;ИмяПеременной:0&quot;</span> <span class="br0">&#91;</span>дополнительные атрибуты<span class="br0">&#93;</span><span class="re2">/&gt;</span></span></div></li>
</ol></div>
<p>Каждый узел <b>Action</b>  может иметь следующие атрибуты:</p>
<ul>
<li><b>Url</b> — обязательный атрибут. Должен содержать HTTP, HTTPS или FTP адрес. Может содержать <a href="#vars">переменные</a>.</li>
<li><b>Type</b>  — тип запроса к серверу. <br/>Может принимать следующие значения: 
	<ul>
		<li><i>get</i> — метод  GET  протокола HTTP </li>
		<li><i>post</i> — метод  POST протокола HTTP </li>
		<li><i>login</i> — то же, что и <i>post</i>, но предназначено только для авторизации. </li>
		<li><i>upload</i> — HTTP POST-запрос в формате multipart/form-data. Именно этот тип запроса используется 
			в большинстве случаев для загрузки файлов.</li>
		<li><i>put</i> — загрузка файла с помощью HTTP PUT запроса или загрузка на FTP. Поддерживается лишь некоторыми серверами.</li>
	</ul>
	</li>
<li><b>PostParams</b> — список параметров, передаваемых серверу по протоколу POST (Type=post или Type=upload), разделенных точкой с запятой.<br/>
Список имеет следующий вид: "<i>НазваниеПараметра1=Значение1;НазваниеПараметра2=Значение2;...</i>"<br/>
Значения могут содержать названия переменных, которые будут автоматически подставлены (раскрыты) перед выполнением запроса.
Также есть особое значение — <i>%filename%</i>, вместо которого в запрос подставляется содержимое загружаемого файла.</li>
<li><b>RegExp</b> — регулярное выражение в формате <a href="http://www.php.ru/manual/reference.pcre.pattern.syntax.html">PCRE</a>. Служит для извлечения необходимой информации (ссылок, идентификаторов) из текста ответа, полученного от сервера (чаще всего HTML страницы). 
Если сопоставление регулярному выражению не удалось, программа генерирует предупреждение в лог ошибок и повторяет запрос.</li>
<li><b>AssignVars</b> — в данном атрибуте перечисляются имена новых переменных, и сопоставленные им номера подмасок 
регулярного выражения. Параметр AssignVars имеет формат "<i>НазваниеПеременной:НомерПодмаски;...</i>". 
Подмаска в регулярном выражении это то, что заключено в круглые скобки. Нумерация подмасок начинается с нуля. 
Имя переменной может содержать символы A-z, 0-9 и символ подчеркивания. 
<a href="#vars">Подробнее о переменных в servers.xml</a></li>
<li><b>OnlyOnce</b> — значение <i>1</i> означает, что данный запрос будет выполняться лишь 1 раз за всю сессию загрузки. 
Чаще всего этим запросом является авторизация на сервере. Значение <i>0</i> - данный запрос выполняется при КАЖДОГО каждого файла.</li>
<li><b>Description</b> — опциональный параметр, содержащий описание текущего действия. Отображается в окне программы.</li>
</ul>
<p>Типичный вид xml-узла Result:</p>
<div class="xml"><ol><li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;Result</span> <span class="re0">ImageUrlTemplate</span>=<span class="st0">&quot;$(Image)&quot;</span> <span class="re0">ThumbUrlTemplate</span>=<span class="st0">&quot;$(Thumb)&quot;</span> <span class="re0">DownloadUrlTemplate</span>=<span class="st0">&quot;$(View)&quot;</span><span class="re2">/&gt;</span></span></div></li>
</ol></div>
<p>Атрибуты узла Result:</p>
<ul>
<li><b>ImageUrlTemplate</b> — строка-шаблон для генерации прямой ссылки на картинку или файл. </li>
<li><b>ThumbUrlTemplate</b>  — строка-шаблон для генерации прямой ссылки на файл миниатюры. 
Если не задан, программа будет сама генерировать миниатюры, даже если включена опция "Использовать серверные миниатюры". 
Генерирование миниатюры будет невозможно, если параметр ImageUrlTemplate не задан или принимает пустое значение. </li>
<li><b>DownloadUrlTemplate</b> — строка-шаблон для генерации ссылки на страницу предпросмотра, скачивания и т.п.</li>
</ul>
<p>Каждый из этих атрибутов может содержать <a href="#vars">переменные</a>. </p>
<p>Один из атрибутов — ImageUrlTemplate или DownloadUrlTemplate  — должен быть обязательно задан. Программа использует тот или иной атрибут в зависимости от настроек, и в зависимости от того, какой из атрибутов задан, а какой нет. По-умолчанию предпочтение отдается прямой ссылке.
В случае использования загрузочного скрипта (атрибут  Plugin узла Server), все атрибуты всё равно должны иметь непустые значения. </p>
<a name="vars"></a>
<h3>Переменные в строках и атрибутах</h3>
<p>Все переменные, доступные для использования в атрибутах узлов Action и Result, задаются в параметре AssignVars, или же встроены в саму программу.</p>
<p>Название переменной может содержать алфавитно-цифровые символы (A-z, 0-9) и символ подчеркивания. Имена переменных чувствительны к регистру. 
Если название переменной начинается с символа подчеркивания, это означает, что данная переменная не будет удалена после загрузки файла, и она останется в памяти на всю сессию загрузки. Однако это не означает, что её значение не может быть перезаписано.</p>
<p>Список встроенных переменных:</p>
<ul>
<li><b>_FILENAME</b> — имя загружаемого файла (без пути к файлу).</li>
<li><b>_FILENAMEWITHOUTEXT</b>  — имя загружаемого файла без расширения.</li>
<li><b>_FILEEXT</b> — расширение файла.</li>
<li><b>_THUMBWIDTH</b> — ширина миниатюры.</li>
<li><b>_RAND16BITS</b> — случайное число от 0 до 65535. Генерируется только один раз при загрузке каждого файла.</li>
<li><b>_LOGIN</b> — имя пользователя (задана, если пользователь включил авторизацию в настройках)</li>
<li><b>_PASSWORD</b> — пароль пользователя.</li>
</ul>
<p>Для подстановки значений переменных в строковые параметры используются конструкции вида <b>$(ИмяПеременной)</b>. Количество подставляемых переменных не ограничивается.
Если переменная не существует, вместо неё будет подставлена пустая строка.</p>
<p>Пример:</p>
<div class="xml"><ol><li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;Server</span> <span class="re0">Name</span>=<span class="st0">&quot;slil.ru&quot;</span> <span class="re0">FileHost</span>=<span class="st0">&quot;1&quot;</span><span class="re2">&gt;</span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="sc3"><span class="re1">&lt;Actions<span class="re2">&gt;</span></span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="sc3"><span class="re1">&lt;Action</span> <span class="re0">Type</span>=<span class="st0">&quot;upload&quot;</span> <span class="re0">Url</span>=<span class="st0">&quot;http://zalil.ru/upload/&quot;</span> <span class="re0">PostParams</span>=<span class="st0">&quot;file=%filename%;submit=Send&quot;</span> <span class="re0">RegExp</span>=<span class="st0">'http://slil.ru/(\d*)'</span> <span class="re0">AssignVars</span>=<span class="st0">&quot;File:0&quot;</span><span class="re2">/&gt;</span></span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp; &nbsp; <span class="sc3"><span class="re1">&lt;/Actions<span class="re2">&gt;</span></span></span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp; &nbsp; <span class="sc3"><span class="re1">&lt;Result</span> <span class="re0">DownloadUrlTemplate</span>=<span class="st0">&quot;http://slil.ru/$(File)&quot;</span><span class="re2">/&gt;</span></span></div></li>
<li class="li1"><div class="de1"><span class="sc3"><span class="re1">&lt;/Server<span class="re2">&gt;</span></span></span></div></li>
</ol></div>
<p>В строке <i>AssignVars="File:0"</i> задается переменная с именем File и ей присваивается некоторое числовое значение, полученное из первой подмаски регулярного выражения (например File=12345). 
Затем созданная переменная используется в параметре <i>DownloadUrlTemplate="<b>http://slil.ru/$(File)</b>"</i>, который в результате подстановки принимает значение "<b><i>http://slil.ru/12345</i></b>". 
Полученную ссылку пользователь видит в окне программы.</p>
<a name="scripts"></a>
<h2>Скрипты загрузки</h2> 
<p>Для расширенной поддержки серверов в программе используются скрипты на <a href="http://www.squirrel-lang.org/doc/squirrel2.html"> языке Squirrel</a>.</p>
<br/>Они должны быть сохранены в кодировке utf-8 в файлах с расширением ".nut".
<div class="javascript"><ol><li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">// Получение списка альбомов(папок, галерей) на сервере</span></div></li>
<li class="li1"><div class="de1"><span class="kw2">function</span> GetFolderList<span class="br0">&#40;</span>list<span class="br0">&#41;</span> </div></li>
<li class="li1"><div class="de1"><span class="br0">&#123;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; <span class="co1">// Код</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="co1">//успех</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">// Функция, создающая альбомы</span></div></li>
<li class="li2"><div class="de2"><span class="kw2">function</span> CreateFolder<span class="br0">&#40;</span>parentAlbum<span class="sy0">,</span>album<span class="br0">&#41;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp;<span class="co1">// Код</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="co1">//успех</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li>
<li class="li2"><div class="de2">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="kw2">function</span> ModifyFolder<span class="br0">&#40;</span>album<span class="br0">&#41;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp;<span class="co1">// Код</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="co1">//успех</span></div></li>
<li class="li2"><div class="de2"><span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">// Функция, загружающая файл</span></div></li>
<li class="li1"><div class="de1"><span class="kw2">function</span> &nbsp;UploadFile<span class="br0">&#40;</span>FileName<span class="sy0">,</span> options<span class="br0">&#41;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#123;</span></div></li>
<li class="li2"><div class="de2">&nbsp; &nbsp; &nbsp;<span class="co1">// Код</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; &nbsp;<span class="kw1">return</span> <span class="nu0">1</span><span class="sy0">;</span> <span class="co1">//успех</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#125;</span></div></li>
<li class="li1"><div class="de1">&nbsp;</div></li>
<li class="li1"><div class="de1"><span class="co1">// Функция, возвращающая список видов ограничений доступа к альбому:</span></div></li>
<li class="li2"><div class="de2"><span class="co1">// приватный, общедоступный, только для друзей и т.п.</span></div></li>
<li class="li1"><div class="de1"><span class="kw2">function</span> GetFolderAccessTypeList<span class="br0">&#40;</span><span class="br0">&#41;</span></div></li>
<li class="li1"><div class="de1"><span class="br0">&#123;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; local a<span class="sy0">=</span><span class="br0">&#91;</span><span class="st0">&quot;ТипДоступа1&quot;</span><span class="sy0">,</span> <span class="st0">&quot;ТипДоступа2&quot;</span><span class="br0">&#93;</span><span class="sy0">;</span></div></li>
<li class="li1"><div class="de1">&nbsp; &nbsp; <span class="kw1">return</span> a<span class="sy0">;</span></div></li>
<li class="li2"><div class="de2"><span class="br0">&#125;</span></div></li>
</ol></div>
<p>
В общем случае необходимо реализовать 1 функцию — <i>UploadFile</i>. Если нужна поддержка серверных альбомов, то необходимо реализовать еще 4 функции — <i>GetFolderList, CreateFolder, ModifyFolder, GetFolderAccessTypeList</i>.</p>
</div>
</div>
<div id="footer">
<p> Последнее обновление данного документа — 28 июля 2010 года. Copyright &copy; 2007 - 2010, <a href="http://zenden.ws/imageuploader" class="link1">ZendeN</a></p>
</div>
</body>
</html>